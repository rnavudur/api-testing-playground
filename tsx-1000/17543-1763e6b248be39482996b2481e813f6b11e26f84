{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import express from\"express\";import fs from\"fs\";import path from\"path\";import{createServer as createViteServer,createLogger}from\"vite\";import viteConfig from\"../vite.config\";import{nanoid}from\"nanoid\";const viteLogger=createLogger();function log(message,source=\"express\"){const formattedTime=new Date().toLocaleTimeString(\"en-US\",{hour:\"numeric\",minute:\"2-digit\",second:\"2-digit\",hour12:true});console.log(`${formattedTime} [${source}] ${message}`)}__name(log,\"log\");async function setupVite(app,server){const serverOptions={middlewareMode:true,hmr:{server},allowedHosts:true};const vite=await createViteServer({...viteConfig,configFile:false,customLogger:{...viteLogger,error:__name((msg,options)=>{viteLogger.error(msg,options);process.exit(1)},\"error\")},server:serverOptions,appType:\"custom\"});app.use(vite.middlewares);app.use(\"*\",async(req,res,next)=>{const url=req.originalUrl;try{const clientTemplate=path.resolve(import.meta.dirname,\"..\",\"client\",\"index.html\");let template=await fs.promises.readFile(clientTemplate,\"utf-8\");template=template.replace(`src=\"/src/main.tsx\"`,`src=\"/src/main.tsx?v=${nanoid()}\"`);const page=await vite.transformIndexHtml(url,template);res.status(200).set({\"Content-Type\":\"text/html\"}).end(page)}catch(e){vite.ssrFixStacktrace(e);next(e)}})}__name(setupVite,\"setupVite\");function serveStatic(app){const distPath=path.resolve(import.meta.dirname,\"public\");if(!fs.existsSync(distPath)){throw new Error(`Could not find the build directory: ${distPath}, make sure to build the client first`)}app.use(express.static(distPath));app.use(\"*\",(_req,res)=>{res.sendFile(path.resolve(distPath,\"index.html\"))})}__name(serveStatic,\"serveStatic\");export{log,serveStatic,setupVite};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAO,YAA+B,UACtC,OAAO,OAAQ,KACf,OAAO,SAAU,OACjB,OAAS,gBAAgB,iBAAkB,iBAAoB,OAE/D,OAAO,eAAgB,iBACvB,OAAS,WAAc,SAEvB,MAAM,WAAa,aAAa,EAEzB,SAAS,IAAI,QAAiB,OAAS,UAAW,CACvD,MAAM,cAAgB,IAAI,KAAK,EAAE,mBAAmB,QAAS,CAC3D,KAAM,UACN,OAAQ,UACR,OAAQ,UACR,OAAQ,IACV,CAAC,EAED,QAAQ,IAAI,GAAG,aAAa,KAAK,MAAM,KAAK,OAAO,EAAE,CACvD,CATgB,kBAWhB,eAAsB,UAAU,IAAc,OAAgB,CAC5D,MAAM,cAAgB,CACpB,eAAgB,KAChB,IAAK,CAAE,MAAO,EACd,aAAc,IAChB,EAEA,MAAM,KAAO,MAAM,iBAAiB,CAClC,GAAG,WACH,WAAY,MACZ,aAAc,CACZ,GAAG,WACH,MAAO,QAAC,IAAK,UAAY,CACvB,WAAW,MAAM,IAAK,OAAO,EAC7B,QAAQ,KAAK,CAAC,CAChB,EAHO,QAIT,EACA,OAAQ,cACR,QAAS,QACX,CAAC,EAED,IAAI,IAAI,KAAK,WAAW,EACxB,IAAI,IAAI,IAAK,MAAO,IAAK,IAAK,OAAS,CACrC,MAAM,IAAM,IAAI,YAEhB,GAAI,CACF,MAAM,eAAiB,KAAK,QAC1B,YAAY,QACZ,KACA,SACA,YACF,EAGA,IAAI,SAAW,MAAM,GAAG,SAAS,SAAS,eAAgB,OAAO,EACjE,SAAW,SAAS,QAClB,sBACA,wBAAwB,OAAO,CAAC,GAClC,EACA,MAAM,KAAO,MAAM,KAAK,mBAAmB,IAAK,QAAQ,EACxD,IAAI,OAAO,GAAG,EAAE,IAAI,CAAE,eAAgB,WAAY,CAAC,EAAE,IAAI,IAAI,CAC/D,OAAS,EAAG,CACV,KAAK,iBAAiB,CAAU,EAChC,KAAK,CAAC,CACR,CACF,CAAC,CACH,CA9CsB,8BAgDf,SAAS,YAAY,IAAc,CACxC,MAAM,SAAW,KAAK,QAAQ,YAAY,QAAS,QAAQ,EAE3D,GAAI,CAAC,GAAG,WAAW,QAAQ,EAAG,CAC5B,MAAM,IAAI,MACR,uCAAuC,QAAQ,uCACjD,CACF,CAEA,IAAI,IAAI,QAAQ,OAAO,QAAQ,CAAC,EAGhC,IAAI,IAAI,IAAK,CAAC,KAAM,MAAQ,CAC1B,IAAI,SAAS,KAAK,QAAQ,SAAU,YAAY,CAAC,CACnD,CAAC,CACH,CAfgB","names":[],"ignoreList":[],"sources":["/home/runner/workspace/server/vite.ts"],"sourcesContent":[null]}}